import torch
from transformers import BertTokenizer, BertModel
from sklearn.metrics.pairwise import cosine_similarity
from tqdm import tqdm
import matplotlib.pyplot as plt
from collections import Counter

device = torch.device("cuda")
tokenizer = BertTokenizer.from_pretrained('bert-base-uncased')
model = BertModel.from_pretrained('bert-base-uncased').to('cuda')

original_words = ['frame', 'attic', 'rafter', 'torch', 'flowers', 'sunroof', 'cabinet', 'garden', 'lawn', 'pipe', 'woodcolumn', 'entrance walk way', 'entry path', 'torches', 'counter', 'music box', 'cornerstone', 'courtyard', 'shutter', 'skywindow', 'spiral staircase', 'antenna', 'couch', 'doorway', 'wraparound balcony', 'facade', 'column', 'beams', 'side table', 'barred window', 'mill', 'endable', 'sidewalk', 'bins', 'glass floor', 'porch light', 'tree leaves', 'balcony rail', 'torchlights', 'door', 'entry', 'balcony door', 'crafting table', 'lava', 'decor', 'parapet', 'window boxes', 'garden soil', 'wooden roof', 'lightbulb', 'leaf', '2nd floor lights', 'terrain', 'bottom', 'driveway', 'yard', 'first floor', 'backyard', 'ice pillar', 'porch overhang', 'furniture', 'support beams', 'concrete column', 'fan', 'torches (indoors, first floor) ()', 'porch framing', 'end table', 'stonewall', 'roof', 'roof tile', 'block island', 'wall light', 'tile ceiling', 'ceiling support', 'mushroom', 'display rack', 'dirt grass', 'railing base', 'sink', 'window trim', 'cornerstones', 'smoke', 'white roof', 'fungation', 'bedframe', 'ledge', 'enchanting table', 'wooden post', 'ladder', 'window surround', 'pink cube', 'cobwebs', 'interior vine', 'second floor ceiling', 'wood beam', 'garden barrier', 'structure', 'stool', 'barricade', 'bookcases', 'stair support', 'entrance patio', 'creditable', 'cobwebs (indoors) ()', 'pumpkins', 'glass block', 'pink railing', 'shelfs', 'ice roof', 'sofa', 'red wall', 'stilt', 'balcony roof', 'pool', 'gravel', 'bookcase table', 'doors', 'posts', 'white cubes', 'f;ower garden', 'roof flowers', 'water', 'wallpaper', 'tower points', 'workstation', 'lava basin', 'platform frame', 'hedge stand', 'wooden walls', 'balcony', 'bedside table', 'mushrooms', 'closet', 'windchime', 'nightshade', 'storage chest', 'roof edge', 'hay patch 1', 'workbenches', 'porch lights', 'wood post', 'window stills', 'window frame', 'ceiling detail', 'floor tile', 'roof center', 'wood overhang', 'kitchen', 'wallpapered wall', 'rock', 'fence path', 'coffee table', 'torches (indoors) ()', 'brewing stations', 'grey boxes', 'path', 'pillar', 'brewing stand', 'ceiling lights', 'shutters', 'pavement', 'pumpkin', 'spiderweb', 'flowerbed', 'ice column', 'decorativebox', 'steel support', 'foundation support', 'bottom of house', 'light wires', 'floor lamp', 'jackolantern', 'woodwall', 'been', 'tree branch', 'glass pillar', 'fixtures', 'torch path', 'front arch', 'bamboo', 'glow stone', 'grate', 'bow', 'angled wall', 'inner wall', 'border', 'ladder entry', 'bathroom sink', 'none', 'floor \\ awning', 'wood support', 'flour', 'entrance', 'ceiling light', 'sand', 'glass', 'pink floor', 'awning', 'purple block', 'moat', 'pin cube', 'battlement', 'red floor', 'stairwell', 'supports', 'decorations', 'roof support column', 'chimney smoke', 'front lights', 'pathlight', 'pattern wall', 'corner decoration', 'brick counter', 'external lighting', 'trashcan', 'glassfence', 'wraparound porch', 'terrace railing', 'glass display', 'starboard', 'support blocks', 'stones', 'purplestatue', 'moat base', 'top balcony', 'desk', 'fixture', 'rails', 'chandelier', 'wooden wall trim', 'wooden floor', 'glassfloor', 'ground', 'threshold', 'jack olantern', 'baseboard', 'enchantment table', 'workbench', 'greenery', 'mound', 'barrier', 'portal', 'washing machine', 'shrub', 'purple block island', 'support foundation', 'doormat', 'tnt cache', 'fountain', 'glass ceiling', 'purple pillar', 'balcony fence', 'frontporch', 'stand', 'air vent', 'grass', 'railings', 'bush', 'web', 'outside stairs', 'floor glass', 'firelit', 'steps', 'lounge', 'bedroom door', 'bookshelves', 'ceiling fan', 'porch roof', 'raised platform', 'front step', 'bookcase decoration', 'woodchest', 'laddersupport', 'door platform', 'middle', 'table', 'walls', 'pans', 'flame', 'stair', 'dome', 'big glow stone', 'entranceway', 'pedestal', 'glowstone decor', 'igloo', 'library', 'orch', 'stairway', 'banister', 'trees', 'jukebox', 'television', 'floor', 'bushes', 'jigsaw blocks', 'refrigerator', 'cobweb', 'throne', 'bathtub', 'outer wall', 'lamps', 'Wainscott', 'double beam', 'top level blocks', 'worktable', 'window shutter', 'sign', 'hearth', 'sandpit', 'door torches', 'tower', 'enclave', 'landing', 'ladder support', 'lamp', 'headboard', 'corner of building', 'torches (indoors, large room) ()', 'crenellation', 'gate', 'solarpanel', 'furnaces', 'railing', 'cupboard', 'first floor ceiling', 'house support', 'interior lighting', 'hedges', 'top of building', 'soil', 'wooden boxes', 'skywalk', 'container', 'glass railing', 'stream', 'alchemy', 'front', 'wooden stilts', 'table and chairs', 'window box', 'blocks', 'deck', 'hay patch 2', 'garage door', 'concrete floors', 'support block', 'basement', 'trellis', 'skylights', 'outdoor light', 'step', 'beam', 'glass barrier', 'support post', 'wall - doorway awning', 'storage', 'kitchen island', 'ceiling', 'painting', 'roof ornament', 'wade', 'greens', 'doorframe', 'top', 'wood floor', 'display', 'helipad', 'chair', 'second story floor', 'piller', 'leaves', 'chimney wall', 'candle', 'windows', 'was', 'umbrella', 'flooring', 'stone roof', 'doorsteps', 'lighting', 'windowframe', 'bricks', 'pink blocks', 'houseplant', 'pink cubes', 'archway', 'marble', 'cabinetry', 'trim', 'floor support', 'interior walls', 'fireplace', 'canopy', 'oven', 'cornice', 'wall frame', 'wall', 'loveseat', 'wall vines', 'staircase', 'roof level', 'shingles', 'bath', 'stereo', 'cauldron', 'shrubs', 'dining table chairs', 'fence', 'enchanter', 'porch floor', 'seats', 'floor \\ ceiling', 'iron', 'statue', 'shrubbery', 'bookshelf', 'structural support', 'roof \\ floor', 'glass roof', 'torchlight', 'stern', 'giant torch', 'panel', 'porch wall', 'patio railing', 'post support', 'patio', 'wood', 'rail', 'crafting bench', 'sconce', 'pond', 'interior nook', 'rooftop', 'front entrance', 'stair roof', 'tower lighting', 'cross support', 'post', 'gates', 'ches', 'pathway', 'candles', 'front steps', 'internal lighting', 'dirt patch 2', 'tree branches', 'bookcase', 'floor tiles', 'chest', 'light', 'arch', 'stone foundation', 'dirt path', 'swimming pool', 'stairs', 'skylight', 'walldecor', 'gable', 'ground support', 'bridge', 'shower', 'stone', 'front door', 'river', 'plant', 'wooden lattice', 'doordecor', 'light fixture', 'paperd wall', 'chiming', 'walkway', 'roof tiles', 'picture window', 'dirt', 'brickwall', 'support column', 'plants', 'boxes', 'pot', 'seating', 'brick roof', 'stone archway', 'bin', 'g;ow stone', 'porch fence', 'torches (outdoors) ()', 'roof window', 'glass wall', 'half-wall', 'curb', 'garage', 'aquarium', 'nothing', 'blue blocks', 'building foundation', 'brick column', 'retaining wall', 'staircase support', 'stairssupport', 'ivy', 'rocks', 'utilities', 'cover', 'stone platform', 'support beam', 'forge', 'pink boxes', 'largebush', 'shaft', 'moss', 'rug', 'nightstands', 'countertop', 'chimney', 'concrete', 'block', 'inner frame', 'roof trim', 'puddle', 'kitchen floor', 'gutter', 'corner lamp', 'facade wall', 'purple pilalr', 'tree trunk', 'glass rail', 'wall vine', 'moat water', 'box', 'stone base', 'display case', 'column support', 'glasswall', 'flower balcony', 'irrigation', 'entry arch', 'potions', 'hanging plant', 'torches (medium room) ()', 'front yard', 'second floor', 'glass window', 'paper wall', 'port', 'stone walkway', 'entryway', 'brown box', 'lattice', 'house stilts', 'waterfall', 'fire', 'furnace', 'kitchen cabinets', 'roof beam', 'bench', 'window ledge', 'hangingplant', 'steps to entrance', 'hull', 'overhang', 'Galway', 'eaves', 'entry steps', 'torches (small room) ()', 'roofs', 'base', 'rack', 'concrete wall', 'garden wall', 'inside wall', 'roof support', 'planter box', 'subfloor', 'all', 'wood archway', 'exterior lighting', 'tile floor', 'tables', 'dispenser', 'inside lights', 'stove', 'stone floor', 'base support', 'interior', 'stoop', 'entertainment center', 'hall floor', 'shelf', 'railing post', 'bar', 'windowsill', 'doorstep', 'axle', 'purple box', 'trunk', 'fern', 'metalbox', 'under window', 'stone pillar', 'indoor plants', 'Wal', 'verdant', 'ladders', 'flower', 'beds', 'round', 'ground floor', 'interior wall', 'chairs', 'vines', 'crate', 'torches (indoors, second floor) ()', 'roofgarden', 'brewer', 'platform', 'dirt patch 1', 'chests', 'cement foundation', 'support', 'dresser', 'tree', 'hedge', 'flower garden', 'headrest', 'red box', 'bedroom floor', 'shelves', 'seat', 'torches (indoor) ()', 'outcroppings', 'carpet', 'tv stand', 'brewers', 'platform to door', 'cross', 'blade', 'random', 'marquee', 'lantern', 'metalchest', 'glass tower', 'floor mat', 'tile', 'nightstand', 'basement floor', 'pillars', 'wood column', 'bottom turret', 'living room floor', 'pink roof', 'lights', 'layer', 'cushions', 'porch railing', 'bars', 'decoration', 'timetable', 'bunker', 'columns', 'planter', 'roof tower', 'hatch', 'ice wall', 'pew', 'wind chimes', 'upper floor', 'porch', 'fencing', 'cactus', 'outside lights', 'deck railing', 'torches (pathway) ()', 'blue', 'stone columns', 'brick border', 'wooden posts', 'cap', 'support wall', 'corner', 'window', 'garden plot', 'island', 'cushion', 'side door', 'foundation', 'shelving', 'farm', 'battlements', 'decksupport', 'safe', 'ferns', 'porch support', 'woodsupport', 'books', 'jack-o-lantern', 'bed']
new_words = ["undetermined", "wall", "window", "vehicle", "roof", "plant", "door", "tower", "furniture", "ground", "beam", "stairs", "column", "banister", "floor", "chimney", "ceiling", "fence", "pool", "corridor", "balcony", "garage", "dome", "road", "gate", "parapet", "buttress", "dormer", "lighting", "arch", "awning", "shutters"]

print(f'original words count: {len(original_words)}')
print(f'new words count: {len(new_words)}')

original_word_features = []
for original_word in tqdm(original_words):
    encoded_input = tokenizer(original_word, return_tensors='pt').to('cuda')
    with torch.no_grad():
        output = model(**encoded_input)
    original_word_feature = output['pooler_output'].cpu().numpy()[0]
    original_word_features.append(original_word_feature)

new_word_features = []
for new_word in tqdm(new_words):
    encoded_input = tokenizer(new_word, return_tensors='pt').to('cuda')
    with torch.no_grad():
        output = model(**encoded_input)
    new_word_feature = output['pooler_output'].cpu().numpy()[0]
    new_word_features.append(new_word_feature)

mapping_results = {}
for original_word_feature, original_word in zip(tqdm(original_word_features), original_words):
    similarities = cosine_similarity([original_word_feature], new_word_features)
    most_similar_idx = similarities.argmax()
    most_similar_word = new_words[most_similar_idx]
    mapping_results[original_word] = most_similar_word

print(mapping_results)
mapping_counts = Counter(mapping_results.values())
print(mapping_counts)

# 막대 그래프를 그리기 위한 데이터 준비
labels = list(mapping_counts.keys())
counts = list(mapping_counts.values())

# 막대 그래프 그리기
plt.figure(figsize=(10, 6))
plt.bar(labels, counts, color='blue')
plt.xlabel('New Words')
plt.ylabel('Number of Mappings')
plt.xticks(rotation=45)
plt.title('Distribution of Mappings from Original Words to New Words')
plt.show()